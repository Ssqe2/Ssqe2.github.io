---
title: "身份证号码结构与哈希约束爆破"
date: 2025-01-01
draft: false
description: "从古诗中提取信息，结合身份证校验算法和 MD5 约束完成爆破"
categories: ["CTF Writeup"]
tags: ["misc", "社工", "MD5", "爆破"]
---

## 前言

遇到过一类有意思的 misc 题：题面是一首藏头诗，每一联暗示了某个人身份证号的一部分信息。最终需要还原出完整的 18 位身份证号，并满足特定的 MD5 哈希约束。

这类题考的不是代码能力，而是信息检索和联想。这里记录一下解题思路和涉及的知识点。

## 身份证号结构

中国居民身份证号码共 18 位：

| 位置 | 含义 |
|------|------|
| 1-6 | 行政区划代码 |
| 7-14 | 出生日期（YYYYMMDD） |
| 15-17 | 顺序码（奇数为男，偶数为女） |
| 18 | 校验码 |

校验码的计算方式：前 17 位分别乘以权重 `[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2]`，求和后对 11 取余，再查表 `['1','0','X','9','8','7','6','5','4','3','2']` 得到校验位。

## 从诗句中提取信息

题面类似这样（以下是虚构的示例）：

> 问其世纪，曰：某某世纪属安全  
> 问其出生，曰：某校区在家旁，某特产饮茶汤  
> 问其生日，曰：不知细叶谁裁出，几月春风似剪刀  
> 问其哈希，曰：开头某某，结尾某某

逐句分析：

- **世纪**：确定出生年份的前两位，比如 22 世纪意味着年份为 `21xx`
- **出生地**：从学校位置、地方特产等线索推断行政区划代码。比如提到某大学在某区，查 [行政区划代码表](https://www.mca.gov.cn/n156/n186/index.html) 可以拿到 6 位编码
- **生日月份**：古诗改编是常见手法。比如贺知章《咏柳》"二月春风似剪刀"，如果题面把"二"换成了"几"，说明答案就是 2 月
- **MD5 约束**：通常会用文化典故暗示 MD5 的前缀或后缀，比如"水浒 108 将"→ 开头 `108`

## 爆破

确定了地区码、年份范围、月份和 MD5 约束后，未知的只剩下：年份后两位、日期、顺序码。这个搜索空间不大，直接爆破：

```python
import hashlib

def calc_check_digit(id17):
    weights = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2]
    check_chars = '10X98765432'
    total = sum(int(id17[i]) * weights[i] for i in range(17))
    return check_chars[total % 11]

area = "XXXXXX"      # 6位地区码
month = "XX"          # 月份
md5_prefix = "xxx"    # MD5开头
md5_suffix = "xxx"    # MD5结尾

for year in range(2100, 2200):
    max_day = 29 if (year % 4 == 0 and (year % 100 != 0 or year % 400 == 0)) else 28
    for day in range(1, max_day + 1):
        for seq in range(0, 1000):
            id17 = f"{area}{year}{month}{day:02d}{seq:03d}"
            check = calc_check_digit(id17)
            full_id = id17 + check
            md5 = hashlib.md5(full_id.encode()).hexdigest()
            if md5.startswith(md5_prefix) and md5.endswith(md5_suffix):
                print(f"Found: {full_id}  MD5: {md5}")
```

如果爆出多个结果，通常可以根据题面中人名的性别倾向来筛选——顺序码末位奇数为男，偶数为女。

## 小结

这类题的套路：
1. 从题面提取身份证各字段的线索
2. 查行政区划代码表确定地区码
3. 利用 MD5 约束大幅缩小搜索空间
4. 写脚本爆破，通常几秒就能出结果

身份证校验码的算法是公开的，18 位中实际上只有 17 位是自由的，第 18 位由前 17 位唯一确定。了解这个结构对解这类题很有帮助。
